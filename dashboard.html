<?php
session_start();
if (!isset($_SESSION['user_id'])) {
  header("Location: index.html");
  exit;
}
?>

<script>
  window.currentUser = {
    id_login: <?= json_encode($_SESSION['user_id']) ?>,
    email: <?= json_encode($_SESSION['email']) ?>,
    role: <?= json_encode($_SESSION['role']) ?>,
    koordinator: <?= json_encode($_SESSION['koordinator']) ?>
  };
</script>

<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FKKI Dashboard - Versi 8 (PHP Ready)</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    
    /* Custom scrollbar - Canva style */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }

    /* Smooth transitions */
    .page-transition {
      animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(100%); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Logo placeholder - Modern gradient */
    .logo-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
      color: white;
      font-weight: 700;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(99, 102, 241, 0.3);
    }

    /* Card hover effects - Canva style */
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (hover: hover) {
      .card-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }
    }

    /* Modern gradient backgrounds */
    .gradient-primary {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    }

    .gradient-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .gradient-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .gradient-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    /* Table responsive */
    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      -webkit-overflow-scrolling: touch;
    }

    /* Modern table styles */
    .modern-table {
      border-collapse: separate;
      border-spacing: 0;
    }

    .modern-table thead tr {
      background: linear-gradient(to right, #f8fafc, #f1f5f9);
    }

    .modern-table tbody tr {
      transition: all 0.2s ease;
    }

    @media (hover: hover) {
      .modern-table tbody tr:hover {
        background-color: #f8fafc;
        transform: scale(1.01);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }
    }

    /* Modal backdrop - Enhanced */
    .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      animation: fadeIn 0.2s ease-out;
    }

    /* Modern button styles */
    .btn-modern {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    @media (hover: hover) {
      .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }
    }

    .btn-modern:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    /* Toast notification - Modern */
    .toast {
      animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Mobile Sidebar - Drawer Style */
    .sidebar {
      background: linear-gradient(180deg, #ffffff 0%, #f9fafb 100%);
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        z-index: 50;
        transform: translateX(-100%);
        width: 280px;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 40;
        animation: fadeIn 0.2s ease-out;
      }
    }

    .nav-item {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      transform: scaleY(0);
      transition: transform 0.2s ease;
    }

    .nav-item.active::before {
      transform: scaleY(1);
    }

    .nav-item.active {
      background: linear-gradient(90deg, rgba(99, 102, 241, 0.08) 0%, transparent 100%);
      color: #6366f1;
      font-weight: 600;
    }

    @media (hover: hover) {
      .nav-item:hover:not(.active) {
        background-color: #f3f4f6;
        transform: translateX(4px);
      }
    }

    /* Stats card animation */
    .stat-card {
      animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Badge modern style */
    .badge-modern {
      padding: 0.375rem 0.875rem;
      border-radius: 9999px;
      font-weight: 600;
      font-size: 0.75rem;
      letter-spacing: 0.025em;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Input focus effect */
    .input-modern:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    /* Mobile Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e5e7eb;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
      z-index: 30;
      animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (min-width: 769px) {
      .bottom-nav {
        display: none;
      }
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 0.5rem;
      color: #6b7280;
      transition: all 0.2s ease;
      flex: 1;
      text-decoration: none;
      position: relative;
    }

    .bottom-nav-item.active {
      color: #6366f1;
    }

    .bottom-nav-item.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 3px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border-radius: 0 0 4px 4px;
    }

    /* Menu Button */
    .menu-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      background: #f3f4f6;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .menu-btn:active {
      transform: scale(0.95);
      background: #e5e7eb;
    }

    @media (min-width: 769px) {
      .menu-btn {
        display: none;
      }
    }

    /* Topbar shadow */
    .topbar-shadow {
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
    }

    /* Touch-friendly tap targets */
    @media (max-width: 768px) {
      .btn-modern {
        min-height: 44px;
        min-width: 44px;
      }

      .input-modern {
        min-height: 48px;
        font-size: 16px;
      }
    }

    /* PHP Ready Alert Box */
    .php-ready-box {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3);
      animation: scaleIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .php-info-card {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      padding: 1.5rem;
      border-radius: 16px;
      margin-top: 1.5rem;
      box-shadow: 0 8px 24px rgba(245, 158, 11, 0.3);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>

 </head>
 <body class="h-full w-full bg-gray-50">
  <div id="app" class="h-full w-full"></div>
  <script>
    /* ========================================
       KONFIGURASI & DATA SAMPLE
       ======================================== */
    
    // Default configuration
    const defaultConfig = {
      app_title: "FKKI Admin",
      welcome_message: "Selamat datang di sistem manajemen FKKI"
    };

    // Simulasi data login dari database
    let loginData = [
      { id_login: 1, email: "admin@fkki.com", password: "admin123", role: "admin", koordinator: null },
      { id_login: 2, email: "koordinator1@fkki.com", password: "koord123", role: "koordinator", koordinator: "Jakarta Pusat" },
      { id_login: 3, email: "koordinator2@fkki.com", password: "koord123", role: "koordinator", koordinator: "Jakarta Selatan" },
      { id_login: 4, email: "pengurus1@fkki.com", password: "pengurus123", role: "pengurus", koordinator: null },
      { id_login: 5, email: "pengurus2@fkki.com", password: "pengurus123", role: "pengurus", koordinator: null }
    ];

    // Simulasi data anggota FKKI dari database
    let dataFKKI = [
      { id: 1, nama: "Dr. Ahmad Fauzi", npa: "12345", instansi: "RS Jakarta", koordinator: "Jakarta Pusat", status: "Aktif" },
      { id: 2, nama: "Dr. Siti Nurhaliza", npa: "12346", instansi: "Klinik Sehat", koordinator: "Jakarta Pusat", status: "Aktif" },
      { id: 3, nama: "Dr. Budi Santoso", npa: "12347", instansi: "RS Harapan", koordinator: "Jakarta Selatan", status: "Aktif" },
      { id: 4, nama: "Dr. Rina Kartika", npa: "12348", instansi: "Puskesmas 1", koordinator: "Jakarta Selatan", status: "Aktif" },
      { id: 5, nama: "Dr. Eko Prasetyo", npa: "12349", instansi: "RS Mitra", koordinator: "Jakarta Pusat", status: "Non-Aktif" }
    ];

    // State aplikasi
    let currentUser = null;
    let currentPage = 'dashboard';

    /* ========================================
       CEK LOGIN STATUS (AUTO LOGIN)
       ======================================== */

        function checkLoginStatus() {
        // pastikan data user dari PHP ada
        if (typeof window.currentUser === 'undefined') {
            alert('Session tidak ditemukan. Silakan login ulang.');
            window.location.href = 'index.html';
            return false;
        }

        // validasi data minimal
        if (!currentUser.email || !currentUser.role) {
            alert('Session tidak valid. Silakan login ulang.');
            window.location.href = 'index.html';
            return false;
        }

        // ‚úÖ login valid
        return true;
        }

    /* ========================================
       FUNGSI UTILITY
       ======================================== */

    function showToast(message, type = 'success') {
      const toastContainer = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast px-6 py-4 rounded-lg shadow-lg text-white mb-3 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
      toast.textContent = message;
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function exportToExcel(data, filename) {
      if (data.length === 0) {
        showToast('Tidak ada data untuk diekspor', 'error');
        return;
      }

      const headers = Object.keys(data[0]);
      const csvContent = [
        headers.join(','),
        ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${filename}.csv`;
      link.click();
      
      showToast('Data berhasil diekspor!');
    }

    function filterByKoordinator(data, userKoordinator) {
      if (!userKoordinator) return data;
      return data.filter(item => item.koordinator === userKoordinator);
    }

    function showPHPInstructions() {
      const modal = `
        <div id="phpModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onclick="closePHPModal(event)">
          <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full p-8 page-transition max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-start mb-6">
              <div>
                <h2 class="text-3xl font-bold text-gray-900 mb-2">üìò Panduan Konversi ke PHP</h2>
                <p class="text-gray-600">Langkah-langkah mengubah dashboard ini menjadi aplikasi PHP</p>
              </div>
              <button onclick="closePHPModal()" class="text-gray-400 hover:text-gray-600 text-2xl">‚úï</button>
            </div>

            <div class="space-y-6">
              <!-- Step 1 -->
              <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl border-l-4 border-indigo-500">
                <h3 class="text-xl font-bold text-gray-900 mb-3">1Ô∏è‚É£ Simpan File HTML sebagai PHP</h3>
                <p class="text-gray-700 mb-3">Ubah ekstensi file dari <code class="bg-white px-2 py-1 rounded text-indigo-600">.html</code> menjadi <code class="bg-white px-2 py-1 rounded text-indigo-600">.php</code></p>
                <div class="bg-white p-3 rounded-lg">
                  <code class="text-sm text-gray-800">dashboard.html ‚Üí dashboard.php</code>
                </div>
              </div>

              <!-- Step 2 -->
              <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border-l-4 border-green-500">
                <h3 class="text-xl font-bold text-gray-900 mb-3">2Ô∏è‚É£ Tambahkan Koneksi Database</h3>
                <p class="text-gray-700 mb-3">Di bagian atas file PHP, tambahkan koneksi database MySQL:</p>
                <div class="bg-gray-900 p-4 rounded-lg overflow-x-auto">
                  <pre class="text-green-400 text-sm"><code>&lt;?php
session_start();

// Konfigurasi database
$host = 'localhost';
$dbname = 'fkki_db';
$username = 'root';
$password = '';

// Koneksi ke database
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch(PDOException $e) {
    die("Koneksi gagal: " . $e->getMessage());
}
?&gt;</code></pre>
                </div>
              </div>

              <!-- Step 3 -->
              <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl border-l-4 border-yellow-500">
                <h3 class="text-xl font-bold text-gray-900 mb-3">3Ô∏è‚É£ Buat Tabel Database</h3>
                <p class="text-gray-700 mb-3">Jalankan SQL berikut di phpMyAdmin atau MySQL client:</p>
                <div class="bg-gray-900 p-4 rounded-lg overflow-x-auto">
                  <pre class="text-yellow-400 text-sm"><code>CREATE TABLE login_data (
    id_login INT PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin', 'koordinator', 'pengurus') NOT NULL,
    koordinator VARCHAR(100)
);

CREATE TABLE data_fkki (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nama VARCHAR(255) NOT NULL,
    npa VARCHAR(50) NOT NULL,
    instansi VARCHAR(255) NOT NULL,
    koordinator VARCHAR(100) NOT NULL,
    status ENUM('Aktif', 'Non-Aktif') NOT NULL
);</code></pre>
                </div>
              </div>

              <!-- Step 4 -->
              <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-xl border-l-4 border-blue-500">
                <h3 class="text-xl font-bold text-gray-900 mb-3">4Ô∏è‚É£ Ganti Data JavaScript dengan PHP</h3>
                <p class="text-gray-700 mb-3">Hapus array JavaScript dan ganti dengan query PHP:</p>
                <div class="bg-gray-900 p-4 rounded-lg overflow-x-auto">
                  <pre class="text-blue-400 text-sm"><code>&lt;?php
// Ambil data login dari database
$stmt = $pdo->query("SELECT * FROM login_data");
$loginData = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Ambil data anggota FKKI
$stmt = $pdo->query("SELECT * FROM data_fkki");
$dataFKKI = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Convert ke JSON untuk JavaScript
$loginDataJSON = json_encode($loginData);
$dataFKKIJSON = json_encode($dataFKKI);
?&gt;

&lt;script&gt;
let loginData = &lt;?php echo $loginDataJSON; ?&gt;;
let dataFKKI = &lt;?php echo $dataFKKIJSON; ?&gt;;
&lt;/script&gt;</code></pre>
                </div>
              </div>

              <!-- Step 5 -->
              <div class="bg-gradient-to-r from-red-50 to-pink-50 p-6 rounded-xl border-l-4 border-red-500">
                <h3 class="text-xl font-bold text-gray-900 mb-3">5Ô∏è‚É£ Buat File API untuk CRUD</h3>
                <p class="text-gray-700 mb-3">Buat file <code class="bg-white px-2 py-1 rounded text-red-600">api.php</code> untuk handle Create, Read, Update, Delete:</p>
                <div class="bg-gray-900 p-4 rounded-lg overflow-x-auto">
                  <pre class="text-red-400 text-sm"><code>&lt;?php
// api.php
require_once 'config.php';

$action = $_POST['action'] ?? $_GET['action'] ?? '';

switch($action) {
    case 'create_anggota':
        $stmt = $pdo->prepare("INSERT INTO data_fkki (nama, npa, instansi, koordinator, status) VALUES (?, ?, ?, ?, ?)");
        $stmt->execute([$_POST['nama'], $_POST['npa'], $_POST['instansi'], $_POST['koordinator'], $_POST['status']]);
        echo json_encode(['success' => true]);
        break;
    
    case 'update_anggota':
        $stmt = $pdo->prepare("UPDATE data_fkki SET nama=?, npa=?, instansi=?, koordinator=?, status=? WHERE id=?");
        $stmt->execute([$_POST['nama'], $_POST['npa'], $_POST['instansi'], $_POST['koordinator'], $_POST['status'], $_POST['id']]);
        echo json_encode(['success' => true]);
        break;
    
    case 'delete_anggota':
        $stmt = $pdo->prepare("DELETE FROM data_fkki WHERE id=?");
        $stmt->execute([$_POST['id']]);
        echo json_encode(['success' => true]);
        break;
}
?&gt;</code></pre>
                </div>
              </div>

              <!-- Step 6 -->
              <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-l-4 border-purple-500">
                <h3 class="text-xl font-bold text-gray-900 mb-3">6Ô∏è‚É£ Update JavaScript untuk AJAX</h3>
                <p class="text-gray-700 mb-3">Ubah fungsi JavaScript agar menggunakan fetch ke API PHP:</p>
                <div class="bg-gray-900 p-4 rounded-lg overflow-x-auto">
                  <pre class="text-purple-400 text-sm"><code>function handleSubmit(event, type, action, id) {
    event.preventDefault();
    
    const formData = new FormData(document.getElementById('crudForm'));
    formData.append('action', action + '_' + type);
    if (id) formData.append('id', id);
    
    fetch('api.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('Data berhasil disimpan!');
            closeModal();
            location.reload(); // Reload untuk update data
        }
    });
}</code></pre>
                </div>
              </div>

              <!-- Tips -->
              <div class="bg-gradient-to-r from-gray-100 to-gray-200 p-6 rounded-xl border-l-4 border-gray-500">
                <h3 class="text-xl font-bold text-gray-900 mb-3">üí° Tips Penting</h3>
                <ul class="space-y-2 text-gray-700">
                  <li class="flex items-start">
                    <span class="text-green-500 mr-2 text-xl">‚úì</span>
                    <span>Gunakan prepared statements untuk mencegah SQL injection</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-green-500 mr-2 text-xl">‚úì</span>
                    <span>Hash password dengan <code class="bg-white px-2 py-1 rounded">password_hash()</code></span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-green-500 mr-2 text-xl">‚úì</span>
                    <span>Tambahkan validasi input di sisi server</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-green-500 mr-2 text-xl">‚úì</span>
                    <span>Implementasikan sistem login dan session yang proper</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-green-500 mr-2 text-xl">‚úì</span>
                    <span>Gunakan HTTPS untuk keamanan data</span>
                  </li>
                </ul>
              </div>

              <!-- Action Button -->
              <div class="flex gap-3">
                <button 
                  onclick="closePHPModal()"
                  class="flex-1 btn-modern px-6 py-3 gradient-primary text-white rounded-xl font-semibold"
                >
                  Mengerti üëç
                </button>
                <button 
                  onclick="window.open('https://www.php.net/manual/en/pdo.prepared-statements.php', '_blank')"
                  class="flex-1 btn-modern px-6 py-3 bg-gray-700 text-white rounded-xl font-semibold"
                >
                  üìö Dokumentasi PHP
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', modal);
    }

    function closePHPModal(event) {
      const modal = document.getElementById('phpModal');
      if (modal && (!event || event.target.id === 'phpModal')) {
        modal.style.opacity = '0';
        setTimeout(() => modal.remove(), 300);
      }
    }

    /* ========================================
       KOMPONEN SIDEBAR & NAVBAR
       ======================================== */

    function renderSidebar() {
      const config = window.elementSdk?.config || defaultConfig;
      
      const menuItems = [
        { id: 'dashboard', icon: 'üìä', label: 'Dashboard', roles: ['admin', 'koordinator', 'pengurus'] },
        { id: 'koordinator', icon: 'üë•', label: 'Data Koordinator', roles: ['admin', 'koordinator', 'pengurus'] },
        { id: 'anggota', icon: 'üë®‚Äç‚öïÔ∏è', label: 'Data Anggota FKKI', roles: ['admin', 'koordinator', 'pengurus'] },
        { id: 'pengurus', icon: 'üëî', label: 'Data Pengurus', roles: ['admin', 'koordinator', 'pengurus'] },
        { id: 'admin', icon: '‚öôÔ∏è', label: 'Data Admin', roles: ['admin'] }
      ];

      const filteredMenu = menuItems.filter(item => item.roles.includes(currentUser.role));

      return `
        <aside id="sidebar" class="sidebar w-64 h-full overflow-y-auto">
          <div class="p-6 border-b border-gray-100">
            <div class="flex items-center space-x-3">
              <div class="w-12 h-12 logo-placeholder text-xs">
                FKKI
              </div>
              <div>
                <h2 class="font-bold text-gray-900 text-lg">${config.app_title || defaultConfig.app_title}</h2>
                <p class="text-xs font-semibold text-indigo-600 uppercase tracking-wide">${currentUser.role}</p>
              </div>
            </div>
          </div>
          
          <nav class="p-4 pb-32">
            <ul class="space-y-2">
              ${filteredMenu.map(item => `
                <li>
                  <button 
                    onclick="navigateTo('${item.id}')"
                    class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-100 transition ${currentPage === item.id ? 'active' : ''}"
                  >
                    <span class="text-2xl">${item.icon}</span>
                    <span class="font-medium text-sm">${item.label}</span>
                  </button>
                </li>
              `).join('')}
            </ul>
          </nav>
          
          <div class="p-4 border-t border-gray-100 absolute bottom-0 w-64 bg-white">
            <div class="mb-4 p-4 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl border border-indigo-100">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full gradient-primary flex items-center justify-center text-white font-bold text-sm shadow-lg">
                  ${currentUser.email.charAt(0).toUpperCase()}
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-gray-900 text-sm truncate">${currentUser.email.split('@')[0]}</p>
                  <p class="text-xs text-gray-500">${currentUser.email.split('@')[1]}</p>
                </div>
              </div>
            </div>
            <button 
              onclick="handleLogout()"
              class="w-full flex items-center justify-center space-x-2 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 transition font-medium"
            >
              <span class="text-xl">üö™</span>
              <span class="text-sm">Keluar</span>
            </button>
          </div>
        </aside>
      `;
    }

    function renderTopbar() {
      const config = window.elementSdk?.config || defaultConfig;
      
      return `
        <header class="topbar-shadow bg-white px-4 md:px-8 py-4 md:py-5 flex justify-between items-center">
          <div class="flex items-center space-x-3">
            <div class="menu-btn" onclick="toggleSidebar()">
              <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </div>
            <div>
              <h1 class="text-lg md:text-2xl font-bold text-gray-900">${getPageTitle()}</h1>
              <p class="text-xs md:text-sm text-gray-500 mt-0.5 md:mt-1 hidden sm:block">${config.welcome_message || defaultConfig.welcome_message}</p>
            </div>
          </div>
          
          <div class="flex items-center space-x-3 md:space-x-4">
            <button
              onclick="showPHPInstructions()"
              class="btn-modern px-4 py-2 gradient-success text-white rounded-lg transition font-semibold text-xs md:text-sm flex items-center gap-2"
            >
              <span>üîß</span>
              <span class="hidden sm:inline">Panduan PHP</span>
            </button>
            <div class="hidden md:block text-right">
              <p class="font-semibold text-gray-900 text-sm">${currentUser.email}</p>
              <p class="text-xs text-indigo-600 font-medium">${currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1)}</p>
            </div>
            <div class="w-10 h-10 md:w-12 md:h-12 rounded-full gradient-primary flex items-center justify-center text-white font-bold shadow-lg text-sm md:text-base">
              ${currentUser.email.charAt(0).toUpperCase()}
            </div>
          </div>
        </header>
      `;
    }

    function getPageTitle() {
      const titles = {
        dashboard: 'Dashboard',
        koordinator: 'Data Koordinator',
        anggota: 'Data Anggota FKKI',
        pengurus: 'Data Pengurus',
        admin: 'Data Admin'
      };
      return titles[currentPage] || 'Dashboard';
    }

    /* ========================================
       KOMPONEN DASHBOARD
       ======================================== */

    function renderDashboard() {
      const totalKoordinator = loginData.filter(u => u.role === 'koordinator').length;
      const totalPengurus = loginData.filter(u => u.role === 'pengurus').length;
      const totalAnggota = currentUser.role === 'koordinator' 
        ? dataFKKI.filter(d => d.koordinator === currentUser.koordinator).length
        : dataFKKI.length;
      const anggotaAktif = currentUser.role === 'koordinator'
        ? dataFKKI.filter(d => d.koordinator === currentUser.koordinator && d.status === 'Aktif').length
        : dataFKKI.filter(d => d.status === 'Aktif').length;

      return `
        <div class="p-4 md:p-8 page-transition pb-24 md:pb-8">
          <!-- PHP Ready Notification -->
          <div class="php-ready-box">
            <div class="flex items-start space-x-4">
              <div class="text-4xl">‚úÖ</div>
              <div class="flex-1">
                <h3 class="text-xl font-bold mb-2">Dashboard Siap Dikonversi ke PHP! üöÄ</h3>
                <p class="text-green-50 mb-3">Dashboard ini sudah dirancang dengan struktur yang mudah dikonversi ke PHP. Klik tombol "Panduan PHP" di header untuk melihat langkah-langkah lengkapnya.</p>
                <div class="flex flex-wrap gap-3">
                  <button 
                    onclick="showPHPInstructions()"
                    class="btn-modern px-5 py-2.5 bg-white text-green-700 rounded-xl transition font-semibold text-sm flex items-center gap-2"
                  >
                    <span>üìò</span> Lihat Panduan
                  </button>
                  <a 
                    href="https://www.php.net/manual/en/pdo.prepared-statements.php"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="btn-modern px-5 py-2.5 bg-green-800 text-white rounded-xl transition font-semibold text-sm flex items-center gap-2"
                  >
                    <span>üìö</span> Dokumentasi PHP
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
            <div class="stat-card card-hover bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-l-4 border-indigo-500">
              <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                <div class="mb-3 md:mb-0">
                  <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Total Koordinator</p>
                  <h3 class="text-2xl md:text-4xl font-bold text-gray-900 mt-2 md:mt-3">${totalKoordinator}</h3>
                  <p class="text-xs text-indigo-600 mt-1 md:mt-2 font-medium">‚Üó Aktif</p>
                </div>
                <div class="w-12 h-12 md:w-16 md:h-16 rounded-xl md:rounded-2xl gradient-primary flex items-center justify-center text-2xl md:text-3xl shadow-lg">
                  üë•
                </div>
              </div>
            </div>

            <div class="stat-card card-hover bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-l-4 border-green-500">
              <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                <div class="mb-3 md:mb-0">
                  <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Total Pengurus</p>
                  <h3 class="text-2xl md:text-4xl font-bold text-gray-900 mt-2 md:mt-3">${totalPengurus}</h3>
                  <p class="text-xs text-green-600 mt-1 md:mt-2 font-medium">‚Üó Aktif</p>
                </div>
                <div class="w-12 h-12 md:w-16 md:h-16 rounded-xl md:rounded-2xl gradient-success flex items-center justify-center text-2xl md:text-3xl shadow-lg">
                  üëî
                </div>
              </div>
            </div>

            <div class="stat-card card-hover bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-l-4 border-purple-500">
              <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                <div class="mb-3 md:mb-0">
                  <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Total Anggota</p>
                  <h3 class="text-2xl md:text-4xl font-bold text-gray-900 mt-2 md:mt-3">${totalAnggota}</h3>
                  <p class="text-xs text-purple-600 mt-1 md:mt-2 font-medium">‚Üó Terdaftar</p>
                </div>
                <div class="w-12 h-12 md:w-16 md:h-16 rounded-xl md:rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-2xl md:text-3xl shadow-lg">
                  üë®‚Äç‚öïÔ∏è
                </div>
              </div>
            </div>

            <div class="stat-card card-hover bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-l-4 border-yellow-500">
              <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                <div class="mb-3 md:mb-0">
                  <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Anggota Aktif</p>
                  <h3 class="text-2xl md:text-4xl font-bold text-gray-900 mt-2 md:mt-3">${anggotaAktif}</h3>
                  <p class="text-xs text-yellow-600 mt-1 md:mt-2 font-medium">‚úì Verified</p>
                </div>
                <div class="w-12 h-12 md:w-16 md:h-16 rounded-xl md:rounded-2xl gradient-warning flex items-center justify-center text-2xl md:text-3xl shadow-lg">
                  ‚úÖ
                </div>
              </div>
            </div>
          </div>

          <!-- PHP Info Card -->
          <div class="php-info-card">
            <div class="flex items-start space-x-4">
              <div class="text-4xl">‚ö°</div>
              <div class="flex-1">
                <h3 class="text-2xl font-bold mb-3">Fitur PHP yang Bisa Ditambahkan</h3>
                <div class="grid md:grid-cols-2 gap-4">
                  <div class="bg-white bg-opacity-20 backdrop-blur-sm p-4 rounded-xl">
                    <h4 class="font-bold mb-2 flex items-center gap-2">
                      <span>üîê</span> Sistem Login & Session
                    </h4>
                    <p class="text-sm text-yellow-50">Implementasi login dengan session PHP dan hash password</p>
                  </div>
                  <div class="bg-white bg-opacity-20 backdrop-blur-sm p-4 rounded-xl">
                    <h4 class="font-bold mb-2 flex items-center gap-2">
                      <span>üíæ</span> Database MySQL
                    </h4>
                    <p class="text-sm text-yellow-50">Simpan data ke database dengan PDO atau MySQLi</p>
                  </div>
                  <div class="bg-white bg-opacity-20 backdrop-blur-sm p-4 rounded-xl">
                    <h4 class="font-bold mb-2 flex items-center gap-2">
                      <span>üõ°Ô∏è</span> Security & Validation
                    </h4>
                    <p class="text-sm text-yellow-50">Prepared statements, CSRF protection, input sanitization</p>
                  </div>
                  <div class="bg-white bg-opacity-20 backdrop-blur-sm p-4 rounded-xl">
                    <h4 class="font-bold mb-2 flex items-center gap-2">
                      <span>üìä</span> Export & Report
                    </h4>
                    <p class="text-sm text-yellow-50">Generate PDF, Excel report dengan PHPExcel/TCPDF</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="card-hover bg-white rounded-xl md:rounded-2xl shadow-md p-5 md:p-8 mt-6">
            <div class="flex items-center justify-between mb-4 md:mb-6">
              <h2 class="text-xl md:text-2xl font-bold text-gray-900">Aktivitas Terbaru</h2>
              <span class="px-3 md:px-4 py-1.5 md:py-2 bg-indigo-50 text-indigo-600 rounded-full text-xs md:text-sm font-semibold">Live</span>
            </div>
            <div class="space-y-3 md:space-y-4">
              <div class="flex items-center space-x-3 md:space-x-4 p-3 md:p-4 bg-gradient-to-r from-indigo-50 to-transparent rounded-xl hover:shadow-md transition">
                <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl gradient-primary flex items-center justify-center text-xl md:text-2xl shadow flex-shrink-0">
                  üìù
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-gray-900 text-sm md:text-base">Data anggota baru ditambahkan</p>
                  <p class="text-xs md:text-sm text-gray-500 truncate">Dr. Ahmad Fauzi - RS Jakarta</p>
                </div>
                <span class="text-xs md:text-sm text-gray-400 font-medium hidden sm:block">2 jam lalu</span>
              </div>
              <div class="flex items-center space-x-3 md:space-x-4 p-3 md:p-4 bg-gradient-to-r from-green-50 to-transparent rounded-xl hover:shadow-md transition">
                <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl gradient-success flex items-center justify-center text-xl md:text-2xl shadow flex-shrink-0">
                  ‚úèÔ∏è
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-gray-900 text-sm md:text-base">Data koordinator diperbarui</p>
                  <p class="text-xs md:text-sm text-gray-500 truncate">Jakarta Pusat - Update informasi</p>
                </div>
                <span class="text-xs md:text-sm text-gray-400 font-medium hidden sm:block">5 jam lalu</span>
              </div>
              <div class="flex items-center space-x-3 md:space-x-4 p-3 md:p-4 bg-gradient-to-r from-red-50 to-transparent rounded-xl hover:shadow-md transition">
                <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl gradient-danger flex items-center justify-center text-xl md:text-2xl shadow flex-shrink-0">
                  üóëÔ∏è
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-gray-900 text-sm md:text-base">Data pengurus dihapus</p>
                  <p class="text-xs md:text-sm text-gray-500 truncate">Removed from system</p>
                </div>
                <span class="text-xs md:text-sm text-gray-400 font-medium hidden sm:block">1 hari lalu</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    /* ========================================
       KOMPONEN DATA KOORDINATOR
       ======================================== */

    function renderKoordinatorPage() {
      const canEdit = currentUser.role === 'admin';
      const koordinatorData = loginData.filter(u => u.role === 'koordinator');
      
      return `
        <div class="p-4 md:p-8 page-transition pb-24 md:pb-8">
          <div class="card-hover bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 md:mb-8">
              <div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900">Data Koordinator</h2>
                <p class="text-gray-500 mt-1">Kelola data koordinator FKKI</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <button 
                  onclick="exportToExcel(${JSON.stringify(koordinatorData).replace(/"/g, '&quot;')}, 'data-koordinator')"
                  class="btn-modern px-4 md:px-5 py-2 md:py-2.5 gradient-success text-white rounded-xl transition font-semibold text-sm flex items-center gap-2"
                >
                  <span>üì•</span> <span class="hidden sm:inline">Export Excel</span>
                </button>
                ${canEdit ? `
                  <button 
                    onclick="openModal('koordinator', 'add')"
                    class="btn-modern px-4 md:px-5 py-2 md:py-2.5 gradient-primary text-white rounded-xl transition font-semibold text-sm flex items-center gap-2"
                  >
                    <span>‚ûï</span> <span class="hidden sm:inline">Tambah Data</span>
                  </button>
                ` : ''}
              </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mb-6">
              <input 
                type="text" 
                id="searchKoordinator"
                oninput="searchTable('koordinator')"
                placeholder="üîç Cari koordinator..."
                class="input-modern flex-1 px-4 md:px-5 py-2 md:py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
              />
              <select 
                id="perPageKoordinator"
                onchange="changePerPage('koordinator')"
                class="input-modern px-4 md:px-5 py-2 md:py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
              >
                <option value="5">5 per halaman</option>
                <option value="10" selected>10 per halaman</option>
                <option value="25">25 per halaman</option>
                <option value="50">50 per halaman</option>
              </select>
            </div>

            <div class="table-container overflow-x-auto">
              <table class="modern-table w-full min-w-full">
                <thead>
                  <tr>
                    <th class="px-4 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">ID</th>
                    <th class="px-4 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Email</th>
                    <th class="px-4 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Wilayah</th>
                    <th class="px-4 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Role</th>
                    ${canEdit ? '<th class="px-4 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Aksi</th>' : ''}
                  </tr>
                </thead>
                <tbody id="koordinatorTableBody" class="bg-white divide-y divide-gray-100">
                  ${renderKoordinatorRows(koordinatorData, canEdit)}
                </tbody>
              </table>
            </div>

            <div id="koordinatorPagination" class="mt-6 md:mt-8 flex justify-center">
              ${renderPagination('koordinator', koordinatorData.length)}
            </div>
          </div>
        </div>
      `;
    }

    function renderKoordinatorRows(data, canEdit, page = 1, perPage = 10) {
      const start = (page - 1) * perPage;
      const end = start + perPage;
      const paginatedData = data.slice(start, end);

      if (paginatedData.length === 0) {
        return `
          <tr>
            <td colspan="${canEdit ? 5 : 4}" class="px-4 py-8 text-center text-gray-500">
              Tidak ada data koordinator
            </td>
          </tr>
        `;
      }

      return paginatedData.map(item => `
        <tr class="hover:bg-gray-50 transition">
          <td class="px-4 md:px-6 py-3 md:py-4 text-sm font-medium text-gray-900">${item.id_login}</td>
          <td class="px-4 md:px-6 py-3 md:py-4 text-sm text-gray-900">${item.email}</td>
          <td class="px-4 md:px-6 py-3 md:py-4 text-sm text-gray-900">${item.koordinator || '-'}</td>
          <td class="px-4 md:px-6 py-3 md:py-4">
            <span class="badge-modern bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700">
              ${item.role}
            </span>
          </td>
          ${canEdit ? `
            <td class="px-4 md:px-6 py-3 md:py-4 text-sm">
              <div class="flex gap-2">
                <button 
                  onclick="openModal('koordinator', 'edit', ${item.id_login})"
                  class="btn-modern px-3 md:px-4 py-1.5 md:py-2 gradient-warning text-white rounded-lg transition text-xs font-semibold"
                >
                  ‚úèÔ∏è <span class="hidden sm:inline">Edit</span>
                </button>
                <button 
                  onclick="deleteData('koordinator', ${item.id_login})"
                  class="btn-modern px-3 md:px-4 py-1.5 md:py-2 gradient-danger text-white rounded-lg transition text-xs font-semibold"
                >
                  üóëÔ∏è <span class="hidden sm:inline">Hapus</span>
                </button>
              </div>
            </td>
          ` : ''}
        </tr>
      `).join('');
    }

    /* ========================================
       KOMPONEN DATA ANGGOTA FKKI
       ======================================== */

    function renderAnggotaPage() {
      const canEdit = currentUser.role === 'admin' || currentUser.role === 'koordinator';
      let anggotaData = dataFKKI;
      
      if (currentUser.role === 'koordinator') {
        anggotaData = filterByKoordinator(dataFKKI, currentUser.koordinator);
      }
      
      return `
        <div class="p-4 md:p-6 page-transition pb-24 md:pb-8">
          <div class="bg-white rounded-xl shadow-md p-4 md:p-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
              <div>
                <h2 class="text-xl md:text-2xl font-bold text-gray-800">Data Anggota FKKI</h2>
                <p class="text-gray-600 text-sm md:text-base">Kelola data anggota FKKI</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <button 
                  onclick="exportToExcel(${JSON.stringify(anggotaData).replace(/"/g, '&quot;')}, 'data-anggota-fkki')"
                  class="px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-medium text-sm"
                >
                  üì• <span class="hidden sm:inline">Export</span>
                </button>
                ${canEdit ? `
                  <button 
                    onclick="openModal('anggota', 'add')"
                    class="px-3 md:px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-medium text-sm"
                  >
                    ‚ûï <span class="hidden sm:inline">Tambah</span>
                  </button>
                ` : ''}
              </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mb-6">
              <input 
                type="text" 
                id="searchAnggota"
                oninput="searchTable('anggota')"
                placeholder="üîç Cari anggota..."
                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              />
              <select 
                id="perPageAnggota"
                onchange="changePerPage('anggota')"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              >
                <option value="5">5 per halaman</option>
                <option value="10" selected>10 per halaman</option>
                <option value="25">25 per halaman</option>
                <option value="50">50 per halaman</option>
              </select>
            </div>

            <div class="table-container overflow-x-auto">
              <table class="w-full min-w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">ID</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Nama</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">NPA</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Instansi</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Koordinator</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Status</th>
                    ${canEdit ? '<th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Aksi</th>' : ''}
                  </tr>
                </thead>
                <tbody id="anggotaTableBody" class="bg-white divide-y divide-gray-200">
                  ${renderAnggotaRows(anggotaData, canEdit)}
                </tbody>
              </table>
            </div>

            <div id="anggotaPagination" class="mt-6 flex justify-center">
              ${renderPagination('anggota', anggotaData.length)}
            </div>
          </div>
        </div>
      `;
    }

    function renderAnggotaRows(data, canEdit, page = 1, perPage = 10) {
      const start = (page - 1) * perPage;
      const end = start + perPage;
      const paginatedData = data.slice(start, end);

      if (paginatedData.length === 0) {
        return `
          <tr>
            <td colspan="${canEdit ? 7 : 6}" class="px-4 py-8 text-center text-gray-500">
              Tidak ada data anggota
            </td>
          </tr>
        `;
      }

      return paginatedData.map(item => `
        <tr class="hover:bg-gray-50 transition">
          <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.id}</td>
          <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800 font-medium">${item.nama}</td>
          <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.npa}</td>
          <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.instansi}</td>
          <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.koordinator}</td>
          <td class="px-3 md:px-4 py-2 md:py-3">
            <span class="px-2 md:px-3 py-1 text-xs font-semibold rounded-full ${item.status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
              ${item.status}
            </span>
          </td>
          ${canEdit ? `
            <td class="px-3 md:px-4 py-2 md:py-3 text-sm">
              <div class="flex gap-2">
                <button 
                  onclick="openModal('anggota', 'edit', ${item.id})"
                  class="px-2 md:px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-xs"
                >
                  ‚úèÔ∏è
                </button>
                <button 
                  onclick="deleteData('anggota', ${item.id})"
                  class="px-2 md:px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-xs"
                >
                  üóëÔ∏è
                </button>
              </div>
            </td>
          ` : ''}
        </tr>
      `).join('');
    }

    /* ========================================
       KOMPONEN DATA PENGURUS
       ======================================== */

    function renderPengurusPage() {
      const canEdit = currentUser.role === 'admin';
      const pengurusData = loginData.filter(u => u.role === 'pengurus');
      
      return `
        <div class="p-4 md:p-6 page-transition pb-24 md:pb-8">
          <div class="bg-white rounded-xl shadow-md p-4 md:p-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
              <div>
                <h2 class="text-xl md:text-2xl font-bold text-gray-800">Data Pengurus</h2>
                <p class="text-gray-600 text-sm md:text-base">Kelola data pengurus FKKI</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <button 
                  onclick="exportToExcel(${JSON.stringify(pengurusData).replace(/"/g, '&quot;')}, 'data-pengurus')"
                  class="px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-medium text-sm"
                >
                  üì• <span class="hidden sm:inline">Export</span>
                </button>
                ${canEdit ? `
                  <button 
                    onclick="openModal('pengurus', 'add')"
                    class="px-3 md:px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-medium text-sm"
                  >
                    ‚ûï <span class="hidden sm:inline">Tambah</span>
                  </button>
                ` : ''}
              </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mb-6">
              <input 
                type="text" 
                id="searchPengurus"
                oninput="searchTable('pengurus')"
                placeholder="üîç Cari pengurus..."
                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              />
              <select 
                id="perPagePengurus"
                onchange="changePerPage('pengurus')"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              >
                <option value="5">5 per halaman</option>
                <option value="10" selected>10 per halaman</option>
                <option value="25">25 per halaman</option>
                <option value="50">50 per halaman</option>
              </select>
            </div>

            <div class="table-container overflow-x-auto">
              <table class="w-full min-w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">ID</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Email</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Role</th>
                    ${canEdit ? '<th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Aksi</th>' : ''}
                  </tr>
                </thead>
                <tbody id="pengurusTableBody" class="bg-white divide-y divide-gray-200">
                  ${renderPengurusRows(pengurusData, canEdit)}
                </tbody>
              </table>
            </div>

            <div id="pengurusPagination" class="mt-6 flex justify-center">
              ${renderPagination('pengurus', pengurusData.length)}
            </div>
          </div>
        </div>
      `;
    }

    function renderPengurusRows(data, canEdit, page = 1, perPage = 10) {
      const start = (page - 1) * perPage;
      const end = start + perPage;
      const paginatedData = data.slice(start, end);

      if (paginatedData.length === 0) {
        return `
          <tr>
            <td colspan="${canEdit ? 4 : 3}" class="px-4 py-8 text-center text-gray-500">
              Tidak ada data pengurus
            </td>
          </tr>
        `;
      }

      return paginatedData.map(item => `
        <tr class="hover:bg-gray-50 transition">
          <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.id_login}</td>
          <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.email}</td>
          <td class="px-3 md:px-4 py-2 md:py-3">
            <span class="px-2 md:px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
              ${item.role}
            </span>
          </td>
          ${canEdit ? `
            <td class="px-3 md:px-4 py-2 md:py-3 text-sm">
              <div class="flex gap-2">
                <button 
                  onclick="openModal('pengurus', 'edit', ${item.id_login})"
                  class="px-2 md:px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-xs"
                >
                  ‚úèÔ∏è
                </button>
                <button 
                  onclick="deleteData('pengurus', ${item.id_login})"
                  class="px-2 md:px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-xs"
                >
                  üóëÔ∏è
                </button>
              </div>
            </td>
          ` : ''}
        </tr>
      `).join('');
    }

    /* ========================================
       KOMPONEN DATA ADMIN
       ======================================== */

    function renderAdminPage() {
      const adminData = loginData.filter(u => u.role === 'admin');
      
      return `
        <div class="p-4 md:p-6 page-transition pb-24 md:pb-8">
          <div class="bg-white rounded-xl shadow-md p-4 md:p-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
              <div>
                <h2 class="text-xl md:text-2xl font-bold text-gray-800">Data Admin</h2>
                <p class="text-gray-600 text-sm md:text-base">Daftar administrator sistem</p>
              </div>
              <button 
                onclick="exportToExcel(${JSON.stringify(adminData).replace(/"/g, '&quot;')}, 'data-admin')"
                class="px-3 md:px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-medium text-sm"
              >
                üì• <span class="hidden sm:inline">Export Excel</span>
              </button>
            </div>

            <div class="table-container overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">ID</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Email</th>
                    <th class="px-3 md:px-4 py-2 md:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Role</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  ${adminData.map(item => `
                    <tr class="hover:bg-gray-50 transition">
                      <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.id_login}</td>
                      <td class="px-3 md:px-4 py-2 md:py-3 text-sm text-gray-800">${item.email}</td>
                      <td class="px-3 md:px-4 py-2 md:py-3">
                        <span class="px-2 md:px-3 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800">
                          ${item.role}
                        </span>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }

    /* ========================================
       MODAL CRUD
       ======================================== */

    function openModal(type, action, id = null) {
      let title = '';
      let formContent = '';

      if (type === 'koordinator' || type === 'pengurus') {
        title = action === 'add' ? `Tambah ${type === 'koordinator' ? 'Koordinator' : 'Pengurus'}` : `Edit ${type === 'koordinator' ? 'Koordinator' : 'Pengurus'}`;
        const data = action === 'edit' ? loginData.find(u => u.id_login === id) : null;
        
        formContent = `
          <form id="crudForm" onsubmit="handleSubmit(event, '${type}', '${action}', ${id})">
            <div class="space-y-4">
              <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input 
                  type="email" 
                  id="email" 
                  required
                  value="${data ? data.email : ''}"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
              
              <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password ${action === 'edit' ? '(kosongkan jika tidak diubah)' : ''}</label>
                <input 
                  type="password" 
                  id="password" 
                  ${action === 'add' ? 'required' : ''}
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>

              ${type === 'koordinator' ? `
                <div>
                  <label for="koordinator" class="block text-sm font-medium text-gray-700 mb-2">Wilayah Koordinator</label>
                  <input 
                    type="text" 
                    id="koordinator" 
                    required
                    value="${data ? data.koordinator || '' : ''}"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Contoh: Jakarta Pusat"
                  />
                </div>
              ` : ''}
              
              <div class="flex gap-3 pt-4">
                <button 
                  type="submit"
                  class="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition font-medium"
                >
                  üíæ Simpan
                </button>
                <button 
                  type="button"
                  onclick="closeModal()"
                  class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition font-medium"
                >
                  ‚ùå Batal
                </button>
              </div>
            </div>
          </form>
        `;
      } else if (type === 'anggota') {
        title = action === 'add' ? 'Tambah Anggota FKKI' : 'Edit Anggota FKKI';
        const data = action === 'edit' ? dataFKKI.find(u => u.id === id) : null;
        
        formContent = `
          <form id="crudForm" onsubmit="handleSubmit(event, '${type}', '${action}', ${id})">
            <div class="space-y-4">
              <div>
                <label for="nama" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                <input 
                  type="text" 
                  id="nama" 
                  required
                  value="${data ? data.nama : ''}"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
              
              <div>
                <label for="npa" class="block text-sm font-medium text-gray-700 mb-2">NPA</label>
                <input 
                  type="text" 
                  id="npa" 
                  required
                  value="${data ? data.npa : ''}"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>

              <div>
                <label for="instansi" class="block text-sm font-medium text-gray-700 mb-2">Instansi</label>
                <input 
                  type="text" 
                  id="instansi" 
                  required
                  value="${data ? data.instansi : ''}"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>

              <div>
                <label for="koordinator" class="block text-sm font-medium text-gray-700 mb-2">Koordinator</label>
                <select 
                  id="koordinator" 
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  <option value="">Pilih Koordinator</option>
                  ${loginData.filter(u => u.role === 'koordinator').map(k => `
                    <option value="${k.koordinator}" ${data && data.koordinator === k.koordinator ? 'selected' : ''}>
                      ${k.koordinator}
                    </option>
                  `).join('')}
                </select>
              </div>

              <div>
                <label for="status" class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                <select 
                  id="status" 
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  <option value="Aktif" ${data && data.status === 'Aktif' ? 'selected' : ''}>Aktif</option>
                  <option value="Non-Aktif" ${data && data.status === 'Non-Aktif' ? 'selected' : ''}>Non-Aktif</option>
                </select>
              </div>
              
              <div class="flex gap-3 pt-4">
                <button 
                  type="submit"
                  class="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition font-medium"
                >
                  üíæ Simpan
                </button>
                <button 
                  type="button"
                  onclick="closeModal()"
                  class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition font-medium"
                >
                  ‚ùå Batal
                </button>
              </div>
            </div>
          </form>
        `;
      }

      const modalHTML = `
        <div id="crudModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onclick="closeModalOnBackdrop(event)">
          <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 page-transition" onclick="event.stopPropagation()">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">${title}</h2>
            ${formContent}
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function closeModal() {
      const modal = document.getElementById('crudModal');
      if (modal) {
        modal.style.opacity = '0';
        setTimeout(() => modal.remove(), 300);
      }
    }

    function closeModalOnBackdrop(event) {
      if (event.target.id === 'crudModal') {
        closeModal();
      }
    }

    function handleSubmit(event, type, action, id) {
      event.preventDefault();

      if (type === 'koordinator' || type === 'pengurus') {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const koordinator = type === 'koordinator' ? document.getElementById('koordinator').value : null;

        if (action === 'add') {
          const newId = Math.max(...loginData.map(u => u.id_login)) + 1;
          loginData.push({
            id_login: newId,
            email,
            password,
            role: type,
            koordinator
          });
          showToast(`${type === 'koordinator' ? 'Koordinator' : 'Pengurus'} berhasil ditambahkan!`);
        } else {
          const index = loginData.findIndex(u => u.id_login === id);
          if (index !== -1) {
            loginData[index].email = email;
            if (password) loginData[index].password = password;
            if (type === 'koordinator') loginData[index].koordinator = koordinator;
            showToast(`${type === 'koordinator' ? 'Koordinator' : 'Pengurus'} berhasil diperbarui!`);
          }
        }

      } else if (type === 'anggota') {
        const nama = document.getElementById('nama').value;
        const npa = document.getElementById('npa').value;
        const instansi = document.getElementById('instansi').value;
        const koordinator = document.getElementById('koordinator').value;
        const status = document.getElementById('status').value;

        if (action === 'add') {
          const newId = Math.max(...dataFKKI.map(u => u.id)) + 1;
          dataFKKI.push({
            id: newId,
            nama,
            npa,
            instansi,
            koordinator,
            status
          });
          showToast('Anggota FKKI berhasil ditambahkan!');
        } else {
          const index = dataFKKI.findIndex(u => u.id === id);
          if (index !== -1) {
            dataFKKI[index] = { id, nama, npa, instansi, koordinator, status };
            showToast('Anggota FKKI berhasil diperbarui!');
          }
        }
      }

      closeModal();
      renderApp();
    }

    /* ========================================
       DELETE DATA
       ======================================== */

    function deleteData(type, id) {
      const confirmModal = `
        <div id="confirmModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop">
          <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 page-transition">
            <div class="text-center">
              <div class="text-5xl mb-4">‚ö†Ô∏è</div>
              <h3 class="text-xl font-bold text-gray-800 mb-2">Konfirmasi Hapus</h3>
              <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.</p>
              <div class="flex gap-3">
                <button 
                  onclick="confirmDelete('${type}', ${id})"
                  class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition font-medium"
                >
                  Ya, Hapus
                </button>
                <button 
                  onclick="closeConfirmModal()"
                  class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition font-medium"
                >
                  Batal
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', confirmModal);
    }

    function confirmDelete(type, id) {
      if (type === 'koordinator' || type === 'pengurus') {
        const index = loginData.findIndex(u => u.id_login === id);
        if (index !== -1) {
          loginData.splice(index, 1);
          showToast(`${type === 'koordinator' ? 'Koordinator' : 'Pengurus'} berhasil dihapus!`);
        }
      } else if (type === 'anggota') {
        const index = dataFKKI.findIndex(u => u.id === id);
        if (index !== -1) {
          dataFKKI.splice(index, 1);
          showToast('Anggota FKKI berhasil dihapus!');
        }
      }

      closeConfirmModal();
      renderApp();
    }

    function closeConfirmModal() {
      const modal = document.getElementById('confirmModal');
      if (modal) modal.remove();
    }

    /* ========================================
       SEARCH & PAGINATION
       ======================================== */

    function searchTable(type) {
      const searchInput = document.getElementById(`search${type.charAt(0).toUpperCase() + type.slice(1)}`).value.toLowerCase();
      let data = [];

      if (type === 'koordinator') {
        data = loginData.filter(u => u.role === 'koordinator');
      } else if (type === 'pengurus') {
        data = loginData.filter(u => u.role === 'pengurus');
      } else if (type === 'anggota') {
        data = currentUser.role === 'koordinator' 
          ? filterByKoordinator(dataFKKI, currentUser.koordinator)
          : dataFKKI;
      }

      const filteredData = data.filter(item => 
        JSON.stringify(item).toLowerCase().includes(searchInput)
      );

      updateTable(type, filteredData);
    }

    function changePerPage(type) {
      const perPage = parseInt(document.getElementById(`perPage${type.charAt(0).toUpperCase() + type.slice(1)}`).value);
      let data = [];

      if (type === 'koordinator') {
        data = loginData.filter(u => u.role === 'koordinator');
      } else if (type === 'pengurus') {
        data = loginData.filter(u => u.role === 'pengurus');
      } else if (type === 'anggota') {
        data = currentUser.role === 'koordinator' 
          ? filterByKoordinator(dataFKKI, currentUser.koordinator)
          : dataFKKI;
      }

      updateTable(type, data, 1, perPage);
    }

    function updateTable(type, data, page = 1, perPage = 10) {
      const canEdit = (type === 'koordinator' || type === 'pengurus') ? currentUser.role === 'admin' : 
                      (type === 'anggota') ? (currentUser.role === 'admin' || currentUser.role === 'koordinator') : false;

      const tbody = document.getElementById(`${type}TableBody`);
      const pagination = document.getElementById(`${type}Pagination`);

      if (type === 'koordinator') {
        tbody.innerHTML = renderKoordinatorRows(data, canEdit, page, perPage);
      } else if (type === 'pengurus') {
        tbody.innerHTML = renderPengurusRows(data, canEdit, page, perPage);
      } else if (type === 'anggota') {
        tbody.innerHTML = renderAnggotaRows(data, canEdit, page, perPage);
      }

      pagination.innerHTML = renderPagination(type, data.length, page, perPage);
    }

    function renderPagination(type, totalData, currentPageNum = 1, perPage = 10) {
      const totalPages = Math.ceil(totalData / perPage);
      
      if (totalPages <= 1) return '';

      let pages = [];
      for (let i = 1; i <= totalPages; i++) {
        pages.push(`
          <button 
            onclick="goToPage('${type}', ${i})"
            class="px-3 md:px-4 py-2 ${i === currentPageNum ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'} border border-gray-300 rounded-lg transition font-medium text-sm"
          >
            ${i}
          </button>
        `);
      }

      return `
        <div class="flex gap-2 flex-wrap justify-center">
          ${pages.join('')}
        </div>
      `;
    }

    function goToPage(type, page) {
      const perPage = parseInt(document.getElementById(`perPage${type.charAt(0).toUpperCase() + type.slice(1)}`).value);
      let data = [];

      if (type === 'koordinator') {
        data = loginData.filter(u => u.role === 'koordinator');
      } else if (type === 'pengurus') {
        data = loginData.filter(u => u.role === 'pengurus');
      } else if (type === 'anggota') {
        data = currentUser.role === 'koordinator' 
          ? filterByKoordinator(dataFKKI, currentUser.koordinator)
          : dataFKKI;
      }

      updateTable(type, data, page, perPage);
    }

    /* ========================================
       NAVIGASI & LOGOUT
       ======================================== */

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      
      if (sidebar) {
        sidebar.classList.toggle('open');
      }
      
      if (overlay) {
        overlay.remove();
      } else {
        const newOverlay = document.createElement('div');
        newOverlay.id = 'sidebar-overlay';
        newOverlay.className = 'sidebar-overlay';
        newOverlay.onclick = () => toggleSidebar();
        document.body.appendChild(newOverlay);
      }
    }

    function navigateTo(page) {
      currentPage = page;
      
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      if (sidebar && sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      }
      if (overlay) {
        overlay.remove();
      }
      
      renderApp();
      
      const mainContent = document.querySelector('main');
      if (mainContent) {
        mainContent.scrollTop = 0;
      }
    }

            function handleLogout() {
            fetch("logout.php")
                .then(() => {
                window.location.href = "index.html";
                });
            }

    function renderBottomNav() {
      const menuItems = [
        { id: 'dashboard', icon: 'üìä', label: 'Dashboard', roles: ['admin', 'koordinator', 'pengurus'] },
        { id: 'anggota', icon: 'üë®‚Äç‚öïÔ∏è', label: 'Anggota', roles: ['admin', 'koordinator', 'pengurus'] },
        { id: 'koordinator', icon: 'üë•', label: 'Koordinator', roles: ['admin', 'koordinator', 'pengurus'] },
        { id: 'pengurus', icon: 'üëî', label: 'Pengurus', roles: ['admin', 'koordinator', 'pengurus'] }
      ];

      const filteredMenu = menuItems.filter(item => item.roles.includes(currentUser.role));
      const mobileMenuItems = filteredMenu.slice(0, 4);

      return `
        <nav class="bottom-nav">
          <div class="flex justify-around items-center">
            ${mobileMenuItems.map(item => `
              <button 
                onclick="navigateTo('${item.id}')"
                class="bottom-nav-item ${currentPage === item.id ? 'active' : ''}"
              >
                <span class="text-xl mb-1">${item.icon}</span>
                <span class="text-xs font-medium">${item.label}</span>
              </button>
            `).join('')}
          </div>
        </nav>
      `;
    }

    /* ========================================
       RENDER APLIKASI UTAMA
       ======================================== */

    function renderApp() {
      const app = document.getElementById('app');

      let mainContent = '';
      
      switch(currentPage) {
        case 'dashboard':
          mainContent = renderDashboard();
          break;
        case 'koordinator':
          mainContent = renderKoordinatorPage();
          break;
        case 'anggota':
          mainContent = renderAnggotaPage();
          break;
        case 'pengurus':
          mainContent = renderPengurusPage();
          break;
        case 'admin':
          mainContent = renderAdminPage();
          break;
        default:
          mainContent = renderDashboard();
      }

      app.innerHTML = `
        <div class="flex h-full w-full bg-gray-50">
          ${renderSidebar()}
          <div class="flex-1 flex flex-col h-full overflow-hidden w-full">
            ${renderTopbar()}
            <main class="flex-1 overflow-y-auto">
              ${mainContent}
            </main>
          </div>
        </div>

        ${renderBottomNav()}

        <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-3 max-w-sm">
        </div>
      `;
    }

    /* ========================================
       ELEMENT SDK INTEGRATION
       ======================================== */

    async function onConfigChange(config) {
      const appTitleElements = document.querySelectorAll('[data-config="app_title"]');
      appTitleElements.forEach(el => {
        el.textContent = config.app_title || defaultConfig.app_title;
      });

      const welcomeElements = document.querySelectorAll('[data-config="welcome_message"]');
      welcomeElements.forEach(el => {
        el.textContent = config.welcome_message || defaultConfig.welcome_message;
      });

      if (currentUser) {
        renderApp();
      }
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
        ])
      });
    }

    /* ========================================
       INITIAL RENDER
       ======================================== */

    // Auto login sebagai admin
    checkLoginStatus();
    renderApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b2ea70d55873dce',t:'MTc2NjU2NDE0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
